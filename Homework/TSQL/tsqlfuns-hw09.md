# Chapter 9, Temporal tables

1. What is a temporal table?
  - My answer: Database versioning/backups, the ability to query data that's current, and also past data.
  - Microsoft's answer: built-in support for providing information about data stored in the table at any point in time rather than only the data that is correct at the current moment in time. [Microsoft Docs](https://docs.microsoft.com/en-us/sql/relational-databases/tables/temporal-tables?view=sql-server-ver15)
2. Under what circumstances would you use a temporal table? Temporal tables are in widespread use in certain kinds of businesses.
  - You need point in time data.
  - comparing current states with older states.
  - slowly changing dimensions.
  - auditing.
  - point-in-time analysis.
  - Allows you to easily revert data in case of a mistake.
3. What are the semantics of a temporal table? There are seven of them.
  - A temporal table must contain the following:
      + Primary key.
      + Two columns with the type DATETIME2, non-nullable, UTC time zone. These represent the start and end times.
      + A start column that should be marked with the option: `GENERATED ALWAYS AS ROW START`.
      + An end column that should be marked with the option: `GENERATED ALWAYS AS ROW END`.
      + A designation of period columns with the option: PERIOD FOR `SYSTEM_TIME(<startcol>,<endcol>)`.
      + A link history table (Can be generated by SQL server)
4. How do you search a history table?
  - Query the history table. Example:
```sql
SELECT *
FROM dbo.EmployeesHistory;
```
5. How do you modify a history table?
  - Modify only the current table, SQL server will modify the history table.
  - Use `INSERT`,`UPDATE`,`DELETE` and `MERGE`
  - If you defined period columns as hidden, you can ignore them.
6. How do you delete date from a history table? Why would you want to delete data from a history table?
  - You cannot directly delete data with **SYSTEM_VERSIONING = ON** option on inside the history table. To delete data you must set **SYSTEM_VERSIONING = OFF. [Microsoft Docs](https://docs.microsoft.com/en-us/sql/relational-databases/tables/modifying-data-in-a-system-versioned-temporal-table?view=sql-server-ver15)
  - Use the `DELETE` and/or `MERGE` statements on the history table.
  - Possible reasons to delete from the history table:
      + Expunge criminal records.
      + To hide criminal behavior, this implies the database manager is the criminal or a hacker has accessed the database.
7. How do you search a history table?
  - The same way you search the regular table, except you add a clause called `FOR SYSTEM_TIME` and a subclause that indicates the validity point or period of time youâ€™re interested in.
8. How do you query all data from both a history file and the current data?
  - If the period table is hidden, you must name is explicitly. If it is not you can query the temporal table like normal without specifying a time to see data of all times.
  - `SELECT * FROM EmployeeHistory FOR SYSTEM_TIME`
9. How do you drop a temporal table?
  - You must turn off **SYSTEM_VERSIONING**.
  - This will convert the temporal table to a regular table, then it can dropped like a normal table.
  - Below is the code that SMSS produces, found from [Microsoft Tech Community](https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/sql-2016-temporal-tables-how-do-you-drop-a-temporal-table/ba-p/371177)
```sql
ALTER TABLE [dbo].[TemporalTest] SET ( SYSTEM_VERSIONING = OFF)
GO
DROP TABLE [dbo].[TemporalTest]
GO
DROP TABLE [dbo].[TemporalTestHistory]
GO
```